\chapter{Type Safety of \Surface}
\label{ch:type-safety}

\section{Type Safety of \CC by Progress and Preservation}
\label{sec:cc-type-safety}

We show that \CC is type safe by proving progress and preservation. Progress
says that a well-typed \CC term does not get stuck. The term is either a value
or a blame, which does not reduce, or the term takes one reduction step. Heap
well-typedness is defined point-wise.

\begin{theorem}[Progress]
\label{thm:progress}
Suppose \PC is well-typed: $\vdash \PC \Leftarrow g$,
$M$ is well-typed: $\emptyset ; \Sigma ; g ; | \PC | \vdash M \Leftarrow A$,
and the heap $\mu$ is also well-typed: $\Sigma \vdash \mu$.
Then either (1) $M$ is a value or (2) $M$ is a blame: {\normalfont $M = \blame{p}$}
or (3) $M$ can take a reduction step:
$\reduce{M}{\mu}{\PC}{N}{\mu'}$ for some $N$ and $\mu'$.
\end{theorem}

The operation semantics of \CC preserves types and the well-typedness of heap:

\begin{theorem}[Preservation]
\label{thm:preservation}
Suppose \PC is well-typed:  $\vdash \PC \Leftarrow g$,
$M$ is well-typed: $\emptyset ; \Sigma ; g ; |\PC| \vdash M \Leftarrow A$
and the heap $\mu$ is also well-typed: $\Sigma \vdash \mu$.
If $\reduce{M}{\mu}{\PC}{N}{\mu'}$, there exists $\Sigma'$ s.t
$\Sigma' \supseteq \Sigma$, $\emptyset ; \Sigma' ; g ; |\PC| \vdash N \Leftarrow A$,
and $\Sigma' \vdash \mu'$.
\end{theorem}

